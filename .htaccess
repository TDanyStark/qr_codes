RewriteEngine On

# ----------------------------------------------------------------------------
# 1. Backend Slim (solo si no existen archivos en /backend/public/tmp)
# ----------------------------------------------------------------------------
# Primero: si el archivo existe en backend/public/tmp, se sirve directo
RewriteCond %{REQUEST_URI} ^/tmp/
RewriteCond %{DOCUMENT_ROOT}/backend/public%{REQUEST_URI} -f
RewriteRule ^ tmp/%{REQUEST_URI} [L]

# Si no existe archivo físico, entonces va a Slim
RewriteCond %{REQUEST_URI} ^/(api|r|tmp) [NC]
RewriteRule ^ backend/public/index.php [QSA,L]

# ----------------------------------------------------------------------------
# 2. Frontend estático
# ----------------------------------------------------------------------------
RewriteCond %{DOCUMENT_ROOT}/frontend%{REQUEST_URI} -f
RewriteRule ^ frontend%{REQUEST_URI} [L]

# ----------------------------------------------------------------------------
# 3. SPA fallback
# ----------------------------------------------------------------------------
RewriteRule ^ frontend/index.html [L]
